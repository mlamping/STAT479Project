---
title: "Milestone 3"
author: "Anisha Gondesi, Mikayla Lamping, Michaela Suski"
date: "4/10/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(readr)
library(tidyverse)
library(patchwork)
library(tidymodels)
library(rgeos)
library(rworldmap)
library(rworldxtra)
library(tibble)
library(ggmap)
library(spData)
library(sf)
```

# Maternal and Fetal Heath Factors and Outcomes

```{r}
mortality <- read_csv("global_mortality.csv") %>%
  filter(year == 2015) %>%
  mutate(maternal = `Maternal deaths (%)`,
         neonatal = `Neonatal deaths (%)`,
         `Maternal deaths (%)` = NULL,
         `Neonatal deaths (%)` = NULL) %>%
  select(c(country, maternal, neonatal)) %>%
  drop_na()
  
haq <- read_csv("haq_index.csv") %>%
  filter(Year == 2015) %>%
  mutate(country = Entity,
         haq = `HAQ Index (IHME (2017))`,
         Entity = NULL,
         `HAQ Index (IHME (2017))` = NULL) %>%
  select(c(country, haq))
```

```{r}
countries <- intersect(mortality$country, haq$country)
mortality <- mortality %>%
  filter(country %in% countries)
haq <- haq %>%
  filter(country %in% countries)

global_ <- inner_join(mortality, haq)
```

```{r}
wmap <- getMap(resolution="high")
centroids <- gCentroid(wmap, byid = TRUE)

locs <- as.data.frame(centroids) %>%
  rownames_to_column("country")
locs$country[236] = "United States"

global <- inner_join(global_, locs) %>%
  drop_na()
```

```{r fig.height = 24, fig.width = 18}
neonatal <- ggplot(global) +
  geom_col(aes(neonatal, reorder(country, neonatal), fill = country)) +
  ylab(label = "") +
  theme(axis.text = element_text(size = 2)) +
  theme_minimal() + 
  guides(fill="none")

maternal <- ggplot(global) + 
  geom_col(aes(maternal, reorder(country, maternal), fill = country)) +
  ylab(label = "") +
  theme(axis.text = element_text(size = 2)) +
  theme_minimal() + 
  guides(fill="none")

haq <- ggplot(global) + 
  geom_col(aes(haq, reorder(country, -haq), fill = country)) +
  ylab(label = "") +
  theme(axis.text = element_text(size = 2)) +
  theme_minimal() + 
  guides(fill="none")

#neonatal + maternal + haq
```

```{r fig.height = 15, fig.width = 20}
world_map <- world %>%
  filter(continent != "Antarctica")

global <- global %>%
  mutate(avg_mortality = rowMeans(select(., c(maternal, neonatal)), na.rm = TRUE))

p1 <- ggplot() +
  geom_sf(data = world_map, fill = "white") +
  geom_point(data = global, aes(x, y, size = haq, col = maternal)) +
  scale_color_distiller(palette = "RdPu", direction = 1) +
  theme_void()

p2 <- ggplot() +
  geom_sf(data = world_map, fill = "white") +
  geom_point(data = global, aes(x, y, size = haq, col = neonatal)) +
  scale_color_distiller(palette = "YlOrBr", direction = 1) +
  theme_void()

p1 / p2 + plot_layout(guides = "collect")
```


